<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dawud Charity Hub - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .rotating {
            animation: rotate 1s linear infinite;
        }
        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        /* Sidebar styles */
        .sidebar-link {
            transition: all 0.2s ease;
        }
        .sidebar-link:hover {
            background: linear-gradient(to right, #EEF2FF, #F8FAFC);
            border-left: 3px solid #3B82F6;
            transform: translateX(2px);
        }
        .sidebar-link.active {
            background: linear-gradient(to right, #DBEAFE, #EFF6FF);
            border-left: 3px solid #2563EB;
            color: #1E40AF;
        }
        /* Smooth transitions */
        .section-content {
            animation: fadeInSection 0.4s ease-in-out;
        }
        @keyframes fadeInSection {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Dashboard Layout -->
    <div class="flex h-screen overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col shadow-lg">
            <!-- Logo Section -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center shadow-md">
                        <i class="fas fa-hand-holding-heart text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">Dawud Charity</h1>
                        <p class="text-xs text-gray-500">Admin Portal</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <a href="#" onclick="switchSection('overview'); return false;" 
                   class="sidebar-link active flex items-center space-x-3 px-4 py-3 text-gray-700 rounded-lg" 
                   data-section="overview">
                    <i class="fas fa-chart-line w-5 text-center"></i>
                    <span class="font-medium">Overview</span>
                </a>

                <a href="#" onclick="switchSection('donations'); return false;" 
                   class="sidebar-link flex items-center space-x-3 px-4 py-3 text-gray-700 rounded-lg" 
                   data-section="donations">
                    <i class="fas fa-hand-holding-usd w-5 text-center"></i>
                    <span class="font-medium">Donations</span>
                </a>

                <a href="#" onclick="switchSection('statistics'); return false;" 
                   class="sidebar-link flex items-center space-x-3 px-4 py-3 text-gray-700 rounded-lg" 
                   data-section="statistics">
                    <i class="fas fa-chart-pie w-5 text-center"></i>
                    <span class="font-medium">Statistics</span>
                </a>

                <div class="my-4 border-t border-gray-200"></div>

                <a href="#" onclick="switchSection('settings'); return false;" 
                   class="sidebar-link flex items-center space-x-3 px-4 py-3 text-gray-700 rounded-lg" 
                   data-section="settings">
                    <i class="fas fa-cog w-5 text-center"></i>
                    <span class="font-medium">Settings</span>
                </a>
            </nav>

            <!-- User Profile Section -->
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center space-x-3 px-3 py-2 bg-gray-50 rounded-lg">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user-shield text-blue-600"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold text-gray-900 truncate" id="sidebar-admin-name">Admin</p>
                        <p class="text-xs text-gray-500">Administrator</p>
                    </div>
                </div>

                <!-- Real-Time Status -->
                <div class="mt-3 flex items-center justify-between px-3 py-2 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <i id="sidebar-realtime-icon" class="fas fa-wifi text-gray-400 text-sm"></i>
                        <span class="text-xs text-gray-600">Real-Time</span>
                    </div>
                    <span id="sidebar-realtime-status" class="text-xs font-medium text-gray-400">OFF</span>
                </div>

                <!-- Logout Button -->
                <button onclick="logout()" 
                        class="mt-3 w-full flex items-center justify-center space-x-2 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors duration-200 shadow-sm hover:shadow-md">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <div>
                    <h2 id="section-title" class="text-2xl font-bold text-gray-900">Overview</h2>
                    <p id="section-subtitle" class="text-sm text-gray-500 mt-1">Welcome back! Here's what's happening</p>
                </div>
                <button id="refresh-btn" onclick="refreshCurrentSection()" 
                        class="group relative px-5 py-2.5 bg-white hover:bg-gray-50 border-2 border-gray-200 hover:border-blue-500 text-gray-700 hover:text-blue-600 rounded-xl flex items-center space-x-2.5 shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden">
                    <!-- Animated background gradient on hover -->
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-50 to-purple-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <!-- Icon with smooth rotation -->
                    <div class="relative z-10 w-5 h-5 flex items-center justify-center">
                        <i id="refresh-icon-btn" class="fas fa-sync-alt text-lg transition-transform duration-500 group-hover:rotate-180"></i>
                    </div>
                    
                    <!-- Text -->
                    <span class="relative z-10 font-semibold text-sm">Refresh Data</span>
                    
                    <!-- Shine effect on hover -->
                    <div class="absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/30 to-transparent"></div>
                </button>
            </header>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6">
                
                <!-- Overview Section -->
                <div id="section-overview" class="section-content">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Total Submissions -->
                        <div class="group relative bg-gradient-to-br from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 rounded-2xl shadow-md hover:shadow-xl p-6 transition-all duration-300 border border-blue-200 hover:border-blue-300 transform hover:-translate-y-1 overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-blue-200 rounded-full -mr-16 -mt-16 opacity-50 group-hover:scale-150 transition-transform duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm font-semibold text-blue-700 uppercase tracking-wide">Total Submissions</p>
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-file-alt text-white text-xl"></i>
                                    </div>
                                </div>
                                <p id="total-submissions" class="text-4xl font-black text-blue-900">0</p>
                            </div>
                        </div>

                        <!-- Verified Count -->
                        <div class="group relative bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-2xl shadow-md hover:shadow-xl p-6 transition-all duration-300 border border-green-200 hover:border-green-300 transform hover:-translate-y-1 overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-green-200 rounded-full -mr-16 -mt-16 opacity-50 group-hover:scale-150 transition-transform duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm font-semibold text-green-700 uppercase tracking-wide">Verified</p>
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-check-circle text-white text-xl"></i>
                                    </div>
                                </div>
                                <p id="verified-count" class="text-4xl font-black text-green-900">0</p>
                            </div>
                        </div>

                        <!-- Pending Count -->
                        <div class="group relative bg-gradient-to-br from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 rounded-2xl shadow-md hover:shadow-xl p-6 transition-all duration-300 border border-orange-200 hover:border-orange-300 transform hover:-translate-y-1 overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-orange-200 rounded-full -mr-16 -mt-16 opacity-50 group-hover:scale-150 transition-transform duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm font-semibold text-orange-700 uppercase tracking-wide">Pending</p>
                                    <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-clock text-white text-xl"></i>
                                    </div>
                                </div>
                                <p id="pending-count" class="text-4xl font-black text-orange-900">0</p>
                            </div>
                        </div>

                        <!-- Total Amount -->
                        <div class="group relative bg-gradient-to-br from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 rounded-2xl shadow-md hover:shadow-xl p-6 transition-all duration-300 border border-purple-200 hover:border-purple-300 transform hover:-translate-y-1 overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-200 rounded-full -mr-16 -mt-16 opacity-50 group-hover:scale-150 transition-transform duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-3">
                                    <p class="text-sm font-semibold text-purple-700 uppercase tracking-wide">Total Amount</p>
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-coins text-white text-xl"></i>
                                    </div>
                                </div>
                                <p id="total-amount" class="text-4xl font-black text-purple-900">0 ETB</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Donations -->
                    <div class="bg-white rounded-2xl shadow-md border border-slate-200 p-6 hover:shadow-lg transition-shadow duration-300">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-history text-slate-600"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-slate-900">Recent Donations</h3>
                                    <p class="text-xs text-slate-500">Last 5 submissions</p>
                                </div>
                            </div>
                        </div>
                        <div id="recent-donations-list" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Donations Section -->
                <div id="section-donations" class="section-content hidden">
                    <div class="bg-white rounded-2xl shadow-md border border-slate-200 p-8 transition-shadow duration-300">
                        <!-- Search and Filters -->
                        <div class="mb-8">
                            <!-- Search Bar -->
                            <div class="mb-5">
                                <div class="relative group">
                                    <input type="text" 
                                           id="search-input" 
                                           placeholder="Search by donor name, transaction reference, or contact..." 
                                           class="w-full px-5 py-4 pl-14 bg-white border-2 border-gray-300 hover:border-blue-400 focus:border-blue-500 rounded-xl text-sm focus:ring-4 focus:ring-blue-100 transition-all duration-200 shadow-sm">
                                    <div class="absolute left-5 top-1/2 transform -translate-y-1/2 w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center group-focus-within:scale-110 transition-transform duration-200">
                                        <i class="fas fa-search text-white text-sm"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Filters Row -->
                            <div class="flex flex-wrap gap-3">
                                <!-- Status Filter -->
                                <div class="relative">
                                    <select id="status-filter" class="pl-11 pr-10 py-3 border-2 border-gray-300 hover:border-blue-400 focus:border-blue-500 rounded-xl text-sm focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-white shadow-sm appearance-none cursor-pointer">
                                        <option value="all">All Status</option>
                                        <option value="verified">Verified</option>
                                        <option value="pending">Pending</option>
                                    </select>
                                    <i class="fas fa-check-circle absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
                                </div>

                                <!-- Time Period Filter -->
                                <div class="relative">
                                    <select id="time-period" class="pl-11 pr-10 py-3 border-2 border-gray-300 hover:border-blue-400 focus:border-blue-500 rounded-xl text-sm focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-white shadow-sm appearance-none cursor-pointer">
                                        <option value="all">All Time</option>
                                        <option value="today">Today</option>
                                        <option value="yesterday">Yesterday</option>
                                        <option value="last-7-days">Last 7 Days</option>
                                        <option value="last-30-days">Last 30 Days</option>
                                        <option value="this-week">This Week</option>
                                        <option value="last-week">Last Week</option>
                                        <option value="this-month">This Month</option>
                                        <option value="last-month">Last Month</option>
                                    </select>
                                    <i class="fas fa-clock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
                                </div>

                                <!-- Sort By -->
                                <div class="relative">
                                    <select id="sort-by" class="pl-11 pr-10 py-3 border-2 border-gray-300 hover:border-blue-400 focus:border-blue-500 rounded-xl text-sm focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-white shadow-sm appearance-none cursor-pointer">
                                        <option value="date-desc">Newest First</option>
                                        <option value="date-asc">Oldest First</option>
                                        <option value="amount-desc">Highest Amount</option>
                                        <option value="amount-asc">Lowest Amount</option>
                                    </select>
                                    <i class="fas fa-sort-amount-down absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
                                </div>

                                <!-- Clear Filters Button -->
                                <button onclick="clearFilters()" class="group relative px-5 py-3 border-2 border-gray-300 hover:border-red-400 text-gray-700 hover:text-red-600 rounded-xl text-sm flex items-center space-x-2 transition-all duration-200 bg-white hover:bg-red-50 shadow-sm overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-r from-red-50 to-orange-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></div>
                                    <i class="fas fa-times-circle relative z-10"></i>
                                    <span class="relative z-10 font-medium">Clear</span>
                                </button>

                                <!-- Export CSV Button -->
                                <button onclick="exportData('csv')" class="group relative ml-auto px-5 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl text-sm flex items-center space-x-2 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-r from-green-700 to-green-800 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></div>
                                    <i class="fas fa-download relative z-10"></i>
                                    <span class="relative z-10 font-semibold">Export CSV</span>
                                    <div class="absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
                                </button>
                            </div>
                        </div>

                        <!-- Table -->
                        <div class="overflow-x-auto rounded-xl border border-slate-200 shadow-sm">
                            <table class="w-full">
                                <thead class="bg-slate-700">
                                    <tr>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-hashtag"></i>
                                                <span>TXN Ref</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-user"></i>
                                                <span>Donor</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-phone"></i>
                                                <span>Contact</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-coins"></i>
                                                <span>Amount</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-university"></i>
                                                <span>Bank</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-calendar"></i>
                                                <span>Date</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-info-circle"></i>
                                                <span>Status</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-image"></i>
                                                <span>Screenshot</span>
                                            </div>
                                        </th>
                                        <th class="px-5 py-4 text-left text-xs font-semibold text-slate-100 uppercase tracking-wider">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-cog"></i>
                                                <span>Actions</span>
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="submissions-table-body" class="bg-white divide-y divide-slate-100">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="mt-8 flex items-center justify-between bg-slate-50 rounded-xl p-5 border border-slate-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-slate-200 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-list text-slate-600"></i>
                                </div>
                                <div>
                                    <div class="text-sm font-semibold text-slate-900">
                                        <span id="showing-start" class="text-slate-700">0</span> - <span id="showing-end" class="text-slate-700">0</span> 
                                        <span class="text-slate-500">of</span> 
                                        <span id="showing-total" class="text-slate-700">0</span>
                                    </div>
                                    <div class="text-xs text-slate-500">Total donations</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button id="prev-page" onclick="previousPage()" class="group relative px-5 py-2.5 bg-white hover:bg-slate-50 border-2 border-slate-300 hover:border-slate-400 text-slate-700 hover:text-slate-900 rounded-xl text-sm font-medium transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:border-slate-300 disabled:hover:text-slate-700 shadow-sm hover:shadow flex items-center space-x-2">
                                    <i class="fas fa-chevron-left text-xs group-hover:-translate-x-0.5 transition-transform duration-200"></i>
                                    <span>Previous</span>
                                </button>
                                <div id="current-page-display" class="px-6 py-2.5 bg-slate-700 text-white rounded-xl text-sm font-semibold shadow-md min-w-[100px] text-center">
                                    Page 1
                                </div>
                                <button id="next-page" onclick="nextPage()" class="group relative px-5 py-2.5 bg-white hover:bg-slate-50 border-2 border-slate-300 hover:border-slate-400 text-slate-700 hover:text-slate-900 rounded-xl text-sm font-medium transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:border-slate-300 disabled:hover:text-slate-700 shadow-sm hover:shadow flex items-center space-x-2">
                                    <span>Next</span>
                                    <i class="fas fa-chevron-right text-xs group-hover:translate-x-0.5 transition-transform duration-200"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Section -->
                <div id="section-statistics" class="section-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Charts and detailed stats would go here -->
                        <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl shadow-md border border-blue-200 p-8 hover:shadow-xl transition-all duration-300">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-chart-bar text-white text-xl"></i>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900">Donation Trends</h3>
                            </div>
                            <div class="text-center py-16">
                                <div class="w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                                    <i class="fas fa-chart-line text-blue-600 text-3xl"></i>
                                </div>
                                <p class="text-gray-600 font-semibold mb-2">Charts Coming Soon</p>
                                <p class="text-sm text-gray-500">Advanced analytics and trends will be available here</p>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-orange-50 to-yellow-50 rounded-2xl shadow-md border border-orange-200 p-8 hover:shadow-xl transition-all duration-300">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-trophy text-white text-xl"></i>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900">Top Donors</h3>
                            </div>
                            <div class="text-center py-16">
                                <div class="w-20 h-20 bg-gradient-to-br from-orange-100 to-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                                    <i class="fas fa-medal text-orange-600 text-3xl"></i>
                                </div>
                                <p class="text-gray-600 font-semibold mb-2">Statistics Coming Soon</p>
                                <p class="text-sm text-gray-500">Top donors leaderboard will be displayed here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="section-settings" class="section-content hidden">
                    <div class="max-w-3xl">
                        <!-- Real-Time Toggle -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900">Real-Time Updates</h3>
                                    <p class="text-sm text-gray-500 mt-1">Receive instant notifications for new donations</p>
                                </div>
                                <button onclick="toggleAutoRefresh()" 
                                        id="settings-realtime-toggle"
                                        class="relative inline-flex items-center h-8 rounded-full w-14 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 bg-gray-200">
                                    <span id="settings-realtime-toggle-dot" class="inline-block w-6 h-6 transform bg-white rounded-full transition-transform translate-x-1"></span>
                                </button>
                            </div>
                            <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <i id="settings-realtime-icon" class="fas fa-wifi text-gray-400"></i>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">Connection Status</p>
                                        <p id="settings-realtime-status" class="text-xs text-gray-500">Disconnected</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Change Password -->
                        <div class="bg-gradient-to-br from-white to-blue-50 rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                            <div class="flex items-center space-x-3 mb-6">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-key text-white text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900">Change Password</h3>
                                    <p class="text-sm text-gray-600">Update your account password</p>
                                </div>
                            </div>
                            
                            <form id="change-password-form" class="space-y-5">
                                <!-- Current Password -->
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-lock text-gray-400 mr-2"></i>
                                        Current Password
                                    </label>
                                    <div class="relative">
                                        <input type="password" id="current-password" required
                                               placeholder="Enter current password"
                                               class="w-full px-4 py-3 pl-11 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white">
                                        <i class="fas fa-shield-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                </div>

                                <!-- New Password -->
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-key text-gray-400 mr-2"></i>
                                        New Password
                                    </label>
                                    <div class="relative">
                                        <input type="password" id="new-password" required
                                               placeholder="Enter new password (min. 6 characters)"
                                               class="w-full px-4 py-3 pl-11 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white">
                                        <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                    <p class="mt-1 text-xs text-gray-500">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Password must be at least 6 characters long
                                    </p>
                                </div>

                                <!-- Confirm Password -->
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fas fa-check-circle text-gray-400 mr-2"></i>
                                        Confirm New Password
                                    </label>
                                    <div class="relative">
                                        <input type="password" id="confirm-password" required
                                               placeholder="Re-enter new password"
                                               class="w-full px-4 py-3 pl-11 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white">
                                        <i class="fas fa-redo absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="pt-2">
                                    <button type="submit" 
                                            class="w-full px-6 py-3.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg font-semibold transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center space-x-2 transform hover:-translate-y-0.5">
                                        <i class="fas fa-save"></i>
                                        <span>Update Password</span>
                                    </button>
                                </div>

                                <!-- Security Tips -->
                                <div class="mt-4 p-4 bg-blue-50 border border-blue-100 rounded-lg">
                                    <p class="text-xs font-semibold text-blue-900 mb-2">
                                        <i class="fas fa-shield-alt mr-1"></i>
                                        Password Security Tips
                                    </p>
                                    <ul class="text-xs text-blue-800 space-y-1">
                                        <li class="flex items-start">
                                            <i class="fas fa-check text-blue-600 mt-0.5 mr-2"></i>
                                            <span>Use a combination of letters, numbers, and symbols</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fas fa-check text-blue-600 mt-0.5 mr-2"></i>
                                            <span>Avoid using personal information</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fas fa-check text-blue-600 mt-0.5 mr-2"></i>
                                            <span>Don't reuse passwords from other accounts</span>
                                        </li>
                                    </ul>
                                </div>
                            </form>
                        </div>

                        <!-- Account Information -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Account Information</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                    <span class="text-sm text-gray-600">Username</span>
                                    <span class="text-sm font-semibold text-gray-900" id="settings-admin-name">Admin</span>
                                </div>
                                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                    <span class="text-sm text-gray-600">Role</span>
                                    <span class="text-sm font-semibold text-blue-600">Administrator</span>
                                </div>
                                <div class="flex items-center justify-between py-2">
                                    <span class="text-sm text-gray-600">Status</span>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-circle text-green-500 text-xs mr-1"></i>
                                        Active
                                    </span>
                                </div>
                            </div>
                            <p class="mt-4 text-xs text-gray-500 italic">To logout, use the button in the sidebar</p>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Image Preview Modal -->
    <div id="image-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[95vh] overflow-hidden fade-in">
            <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-receipt text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-900">Payment Proof Screenshot</h3>
                        <p class="text-sm text-gray-600">View donation verification screenshot</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="download-image-btn" class="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-lg transition-colors">
                        <i class="fas fa-download mr-2"></i>Download
                    </button>
                    <button id="close-image-modal" class="text-gray-500 hover:text-gray-700 hover:bg-gray-100 p-2 rounded-lg transition-all">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="relative p-6 overflow-auto max-h-[calc(95vh-140px)] bg-gray-50">
                <div id="image-loading" class="flex flex-col items-center justify-center py-16">
                    <div class="loading-spinner w-16 h-16 mb-4"></div>
                    <p class="text-gray-700 font-medium">Loading screenshot...</p>
                </div>
                
                <div id="image-content" class="hidden">
                    <img id="preview-image" src="" alt="Donation Proof" class="w-full h-auto rounded-xl shadow-2xl border-4 border-white cursor-pointer hover:shadow-3xl transition-shadow">
                </div>
                
                <div id="image-error" class="hidden text-center py-16">
                    <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
                    </div>
                    <h4 class="text-xl font-bold text-red-600">Failed to Load Image</h4>
                    <p class="text-gray-600 mt-2">The screenshot could not be loaded.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full fade-in">
            <div class="p-6">
                <!-- Icon and Title -->
                <div class="flex items-start space-x-4">
                    <div id="confirm-icon-container" class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center">
                        <i id="confirm-icon" class="text-2xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 id="confirm-title" class="text-xl font-bold text-gray-900 mb-2"></h3>
                        <p id="confirm-message" class="text-gray-600"></p>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="mt-6 flex items-center justify-end space-x-3">
                    <button id="confirm-cancel" 
                            class="px-6 py-2.5 border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors duration-200">
                        Cancel
                    </button>
                    <button id="confirm-ok" 
                            class="px-6 py-2.5 text-white rounded-lg font-medium transition-colors duration-200">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // Global state
        let currentSection = 'overview';
        let currentPage = 0;
        let totalPages = 0;
        let totalSubmissions = 0;
        let submissionsData = [];
        let autoRefreshInterval = null;
        let isRefreshing = false;
        let searchTimeout = null;

        // API Base URL
        const API_BASE = window.location.origin;
        
        // WebSocket token (injected server-side)
        const WS_TOKEN = null;
        
        // WebSocket state
        let ws = null;
        let wsConnected = false;
        let wsEnabled = true;
        let wsReconnectAttempts = 0;
        let wsMaxReconnectAttempts = 5;
        let wsReconnectDelay = 3000;
        let wsManualDisconnect = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded');
            initializeDashboard();
        });

        async function initializeDashboard() {
            console.log('Initializing dashboard...');
            
            try {
                // Load initial data
                await loadDashboardStats();
                await loadSubmissions();
                
                // Set up event listeners
                setupEventListeners();
                
                // Set up WebSocket
                setupAutoRefresh();
                
                console.log('Dashboard initialized successfully');
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                showToast('Failed to initialize dashboard', 'error');
            }
        }

        function setupEventListeners() {
            // Search with debounce (wait 500ms after user stops typing)
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchValue = e.target.value;
                    console.log('Search input changed:', searchValue);
                    
                    // Clear previous timeout
                    if (searchTimeout) {
                        clearTimeout(searchTimeout);
                    }
                    
                    // Set new timeout to call backend after 500ms
                    searchTimeout = setTimeout(() => {
                        loadSubmissions(searchValue);
                    }, 500);
                });
            } else {
                console.error('search-input element not found');
            }
            
            // Filters
            document.getElementById('status-filter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('time-period').addEventListener('change', applyFiltersAndSort);
            document.getElementById('sort-by').addEventListener('change', applyFiltersAndSort);
            
            // Change password form
            document.getElementById('change-password-form').addEventListener('submit', handleChangePassword);
            
            // Close image modal
            document.getElementById('close-image-modal').addEventListener('click', function() {
                document.getElementById('image-modal').classList.add('hidden');
            });
        }

        // Section Switching
        function switchSection(sectionName) {
            currentSection = sectionName;
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('[id^="section-"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(`section-${sectionName}`).classList.remove('hidden');
            
            // Update header
            const titles = {
                'overview': { title: 'Overview', subtitle: "Welcome back! Here's what's happening" },
                'donations': { title: 'Donations', subtitle: 'Manage and verify donation submissions' },
                'statistics': { title: 'Statistics', subtitle: 'View detailed analytics and trends' },
                'settings': { title: 'Settings', subtitle: 'Manage your account and preferences' }
            };
            
            const titleInfo = titles[sectionName] || titles['overview'];
            document.getElementById('section-title').textContent = titleInfo.title;
            document.getElementById('section-subtitle').textContent = titleInfo.subtitle;
            
            // Show/hide refresh button based on section
            const refreshBtn = document.getElementById('refresh-btn');
            const sectionsWithRefresh = ['overview', 'donations'];
            
            if (sectionsWithRefresh.includes(sectionName)) {
                refreshBtn.classList.remove('hidden');
                refreshBtn.style.animation = 'fadeIn 0.3s ease-in';
            } else {
                refreshBtn.classList.add('hidden');
            }
        }

        // Load Dashboard Stats
        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/dashboard-stats`, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    
                    document.getElementById('total-submissions').textContent = stats.total_submissions || 0;
                    document.getElementById('verified-count').textContent = stats.verified_count || 0;
                    document.getElementById('pending-count').textContent = stats.pending_count || 0;
                    document.getElementById('total-amount').textContent = formatCurrency(stats.total_amount || 0);
                    
                    // Update recent donations
                    updateRecentDonations();
                } else {
                    throw new Error('Failed to load stats');
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                showToast('Failed to load dashboard statistics', 'error');
            }
        }

        // Load Submissions
        async function loadSubmissions(searchQuery = '') {
            try {
                // Build URL with search parameter (no limit to fetch all donations)
                let url = `${API_BASE}/api/admin/submissions?limit=999999`;
                if (searchQuery) {
                    url += `&search=${encodeURIComponent(searchQuery)}`;
                }
                
                const response = await fetch(url, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    submissionsData = await response.json();
                    applyFiltersAndSort();
                    updateRecentDonations(); // Update recent donations in overview
                } else {
                    throw new Error('Failed to load submissions');
                }
            } catch (error) {
                console.error('Error loading submissions:', error);
                showToast('Failed to load donations', 'error');
            }
        }

        // Apply Filters and Sort
        // Helper function to get date range based on time period
        function getDateRange(period) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            switch(period) {
                case 'today':
                    return {
                        start: today,
                        end: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999)
                    };
                    
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    return {
                        start: yesterday,
                        end: new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 23, 59, 59, 999)
                    };
                    
                case 'last-7-days':
                    const last7 = new Date(today);
                    last7.setDate(last7.getDate() - 7);
                    return { start: last7, end: now };
                    
                case 'last-30-days':
                    const last30 = new Date(today);
                    last30.setDate(last30.getDate() - 30);
                    return { start: last30, end: now };
                    
                case 'this-week':
                    const firstDayOfWeek = new Date(today);
                    firstDayOfWeek.setDate(today.getDate() - today.getDay());
                    return { start: firstDayOfWeek, end: now };
                    
                case 'last-week':
                    const lastWeekStart = new Date(today);
                    lastWeekStart.setDate(today.getDate() - today.getDay() - 7);
                    const lastWeekEnd = new Date(lastWeekStart);
                    lastWeekEnd.setDate(lastWeekStart.getDate() + 6);
                    lastWeekEnd.setHours(23, 59, 59, 999);
                    return { start: lastWeekStart, end: lastWeekEnd };
                    
                case 'this-month':
                    const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                    return { start: firstDayOfMonth, end: now };
                    
                case 'last-month':
                    const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59, 999);
                    return { start: lastMonthStart, end: lastMonthEnd };
                    
                default:
                    return null;
            }
        }

        function applyFiltersAndSort() {
            const statusFilter = document.getElementById('status-filter').value;
            const timePeriod = document.getElementById('time-period')?.value || 'all';
            const sortBy = document.getElementById('sort-by').value;
            
            console.log('Applying filters - Total data:', submissionsData.length);
            
            // Reset to page 1 when filters change
            currentPage = 0;
            
            let filtered = [...submissionsData];
            
            // Note: Search is now handled by backend in loadSubmissions()
            // Only apply frontend filters for status and time period
            
            // Apply status filter
            if (statusFilter !== 'all') {
                filtered = filtered.filter(s => {
                    if (statusFilter === 'verified') return s.is_verified;
                    if (statusFilter === 'pending') return !s.is_verified;
                    return true;
                });
            }
            
            // Apply time period filter
            if (timePeriod !== 'all') {
                const dateRange = getDateRange(timePeriod);
                if (dateRange) {
                    filtered = filtered.filter(s => {
                        const submittedDate = new Date(s.submitted_at);
                        return submittedDate >= dateRange.start && submittedDate <= dateRange.end;
                    });
                }
            }
            
            // Apply sorting
            filtered.sort((a, b) => {
                if (sortBy === 'date-desc') return new Date(b.submitted_at) - new Date(a.submitted_at);
                if (sortBy === 'date-asc') return new Date(a.submitted_at) - new Date(b.submitted_at);
                if (sortBy === 'amount-desc') return b.amount_donated - a.amount_donated;
                if (sortBy === 'amount-asc') return a.amount_donated - b.amount_donated;
                return 0;
            });
            
            // Pagination
            const itemsPerPage = 10;
            totalPages = Math.ceil(filtered.length / itemsPerPage);
            const start = currentPage * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filtered.slice(start, end);
            
            // Render table
            renderSubmissionsTable(pageData);
            
            // Update pagination
            updatePagination(filtered.length, start, end);
        }
        
        // Clear all filters
        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('status-filter').value = 'all';
            document.getElementById('time-period').value = 'all';
            document.getElementById('sort-by').value = 'date-desc';
            currentPage = 0;
            
            // Reload submissions without search query
            loadSubmissions('');
            showToast('Filters cleared', 'info', 2000);
        }

        // Render Submissions Table
        function renderSubmissionsTable(submissions) {
            const tbody = document.getElementById('submissions-table-body');
            tbody.innerHTML = '';
            
            if (submissions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center text-slate-500">No donations found</td></tr>';
                return;
            }
            
            submissions.forEach(submission => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-50 transition-colors duration-150';
                
                const statusBadge = submission.is_verified 
                    ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200"><i class="fas fa-check-circle mr-1"></i>Verified</span>'
                    : '<span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200"><i class="fas fa-clock mr-1"></i>Pending</span>';
                
                const imageButton = submission.proof_image_path
                    ? `<button onclick="viewImage('${submission.proof_image_path}')" class="inline-flex items-center px-3 py-1.5 bg-slate-600 hover:bg-slate-700 text-white text-xs font-medium rounded-lg transition-all duration-150 shadow-sm hover:shadow"><i class="fas fa-image mr-1.5"></i>View</button>`
                    : '<span class="text-slate-400 text-xs font-medium">No Image</span>';
                
                const actionButton = submission.is_verified
                    ? `<button onclick="toggleVerification(${submission.id})" class="inline-flex items-center px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 hover:text-slate-900 border border-slate-300 text-xs font-medium rounded-lg transition-all duration-150"><i class="fas fa-times-circle mr-1.5"></i>Unverify</button>`
                    : `<button onclick="toggleVerification(${submission.id})" class="inline-flex items-center px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium rounded-lg transition-all duration-150 shadow-sm hover:shadow"><i class="fas fa-check-circle mr-1.5"></i>Verify</button>`;
                
                tr.innerHTML = `
                    <td class="px-4 py-3 text-sm font-mono text-slate-700">${submission.transaction_reference}</td>
                    <td class="px-4 py-3 text-sm font-medium text-slate-900">${submission.donor_name}</td>
                    <td class="px-4 py-3 text-sm text-slate-600">${submission.donor_contact || '-'}</td>
                    <td class="px-4 py-3 text-sm font-semibold text-slate-900">${formatCurrency(submission.amount_donated)}</td>
                    <td class="px-4 py-3 text-sm text-slate-600">${formatBankName(submission.bank_used)}</td>
                    <td class="px-4 py-3 text-sm text-slate-500">${formatDate(submission.submitted_at)}</td>
                    <td class="px-4 py-3">${statusBadge}</td>
                    <td class="px-4 py-3">${imageButton}</td>
                    <td class="px-4 py-3">${actionButton}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Update Recent Donations
        function updateRecentDonations() {
            const container = document.getElementById('recent-donations-list');
            const recent = submissionsData.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-inbox text-gray-400 text-2xl"></i>
                        </div>
                        <p class="text-gray-500 font-medium">No donations yet</p>
                        <p class="text-xs text-gray-400 mt-1">Recent donations will appear here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(donation => `
                <div onclick="viewDonationDetails()" 
                     class="group relative flex items-center gap-4 p-4 bg-white hover:bg-slate-50 rounded-lg transition-all duration-200 cursor-pointer border border-slate-200 hover:border-slate-300 hover:shadow-md">
                    
                    <!-- Left: Icon with Badge -->
                    <div class="relative flex-shrink-0">
                        <div class="w-11 h-11 bg-slate-100 group-hover:bg-slate-200 rounded-lg flex items-center justify-center transition-all duration-200">
                            <i class="fas fa-hand-holding-usd text-slate-600 text-lg"></i>
                        </div>
                        ${donation.is_verified 
                            ? '<div class="absolute -top-1 -right-1 w-5 h-5 bg-emerald-500 rounded-full border-2 border-white flex items-center justify-center shadow-sm"><i class="fas fa-check text-white text-xs"></i></div>'
                            : '<div class="absolute -top-1 -right-1 w-5 h-5 bg-slate-400 rounded-full border-2 border-white flex items-center justify-center shadow-sm"><i class="fas fa-clock text-white text-xs"></i></div>'
                        }
                    </div>
                    
                    <!-- Center: Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <p class="text-sm font-semibold text-slate-900 truncate">${donation.donor_name}</p>
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${donation.is_verified ? 'bg-emerald-50 text-emerald-700 border border-emerald-200' : 'bg-slate-100 text-slate-600 border border-slate-200'}">
                                ${donation.is_verified ? 'Verified' : 'Pending'}
                            </span>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-slate-500">
                            <i class="fas fa-calendar-alt text-slate-400"></i>
                            <span>${formatDate(donation.submitted_at)}</span>
                        </div>
                    </div>
                    
                    <!-- Right: Amount & Arrow -->
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <p class="text-sm font-bold text-slate-900">${formatCurrency(donation.amount_donated)}</p>
                        </div>
                        <div class="w-7 h-7 bg-slate-100 group-hover:bg-slate-600 rounded-md flex items-center justify-center transition-all duration-200">
                            <i class="fas fa-arrow-right text-slate-500 group-hover:text-white text-xs transition-colors duration-200"></i>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // View Donation Details (just navigate to donations section)
        function viewDonationDetails() {
            // Simply switch to donations section
            switchSection('donations');
        }

        // Load Banks List
        async function loadBanksList() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/banks`, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const banks = await response.json();
                    const container = document.getElementById('banks-list');
                    
                    container.innerHTML = banks.map(bank => `
                        <div class="p-6 bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl border border-gray-200 hover:shadow-md transition-shadow">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-university text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900">${formatBankName(bank)}</h4>
                                    <p class="text-sm text-gray-600">Active</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading banks:', error);
            }
        }

        // Update Pagination
        function updatePagination(total, start, end) {
            document.getElementById('showing-start').textContent = total > 0 ? start + 1 : 0;
            document.getElementById('showing-end').textContent = Math.min(end, total);
            document.getElementById('showing-total').textContent = total;
            document.getElementById('current-page-display').textContent = `Page ${currentPage + 1}`;
            
            document.getElementById('prev-page').disabled = currentPage === 0;
            document.getElementById('next-page').disabled = currentPage >= totalPages - 1;
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                applyFiltersAndSort();
            }
        }

        function nextPage() {
            if (currentPage < totalPages - 1) {
                currentPage++;
                applyFiltersAndSort();
            }
        }

        // Toggle Verification
        async function toggleVerification(submissionId) {
            const submission = submissionsData.find(s => s.id == submissionId);
            if (!submission) return;
            
            const isCurrentlyVerified = submission.is_verified;
            const action = isCurrentlyVerified ? 'unverify' : 'verify';
            
            // Show confirmation modal
            const confirmed = await showConfirmationModal(
                isCurrentlyVerified ? 'Unverify Donation' : 'Verify Donation',
                isCurrentlyVerified 
                    ? `Are you sure you want to unverify this donation from ${submission.donor_name}? This will mark it as pending.`
                    : `Are you sure you want to verify this donation from ${submission.donor_name}? This will confirm it as legitimate.`,
                isCurrentlyVerified ? 'warning' : 'success'
            );
            
            if (!confirmed) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/submissions/${submissionId}/verify`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ is_verified: !isCurrentlyVerified })
                });
                
                if (response.ok) {
                    submission.is_verified = !isCurrentlyVerified;
                    submission.verified_at = new Date().toISOString();
                    
                    showToast(`Donation ${action}ied successfully`, 'success');
                    
                    await loadDashboardStats();
                    applyFiltersAndSort();
                } else {
                    throw new Error(`Failed to ${action} donation`);
                }
            } catch (error) {
                console.error('Error:', error);
                showToast(error.message, 'error');
            }
        }
        
        // Show Confirmation Modal
        function showConfirmationModal(title, message, type = 'info') {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmation-modal');
                const titleEl = document.getElementById('confirm-title');
                const messageEl = document.getElementById('confirm-message');
                const iconContainer = document.getElementById('confirm-icon-container');
                const icon = document.getElementById('confirm-icon');
                const okBtn = document.getElementById('confirm-ok');
                const cancelBtn = document.getElementById('confirm-cancel');
                
                // Set content
                titleEl.textContent = title;
                messageEl.textContent = message;
                
                // Set styling based on type
                const styles = {
                    'success': {
                        iconBg: 'bg-green-100',
                        iconColor: 'text-green-600',
                        icon: 'fas fa-check-circle',
                        btnBg: 'bg-green-600 hover:bg-green-700'
                    },
                    'warning': {
                        iconBg: 'bg-orange-100',
                        iconColor: 'text-orange-600',
                        icon: 'fas fa-exclamation-triangle',
                        btnBg: 'bg-orange-600 hover:bg-orange-700'
                    },
                    'error': {
                        iconBg: 'bg-red-100',
                        iconColor: 'text-red-600',
                        icon: 'fas fa-exclamation-circle',
                        btnBg: 'bg-red-600 hover:bg-red-700'
                    },
                    'info': {
                        iconBg: 'bg-blue-100',
                        iconColor: 'text-blue-600',
                        icon: 'fas fa-info-circle',
                        btnBg: 'bg-blue-600 hover:bg-blue-700'
                    }
                };
                
                const style = styles[type] || styles['info'];
                
                iconContainer.className = `flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center ${style.iconBg}`;
                icon.className = `${style.icon} ${style.iconColor} text-2xl`;
                okBtn.className = `px-6 py-2.5 text-white rounded-lg font-medium transition-colors duration-200 ${style.btnBg}`;
                
                // Show modal
                modal.classList.remove('hidden');
                
                // Handle buttons
                const handleOk = () => {
                    modal.classList.add('hidden');
                    cleanup();
                    resolve(true);
                };
                
                const handleCancel = () => {
                    modal.classList.add('hidden');
                    cleanup();
                    resolve(false);
                };
                
                const cleanup = () => {
                    okBtn.removeEventListener('click', handleOk);
                    cancelBtn.removeEventListener('click', handleCancel);
                };
                
                okBtn.addEventListener('click', handleOk);
                cancelBtn.addEventListener('click', handleCancel);
                
                // Close on escape key
                const handleEscape = (e) => {
                    if (e.key === 'Escape') {
                        handleCancel();
                        document.removeEventListener('keydown', handleEscape);
                    }
                };
                document.addEventListener('keydown', handleEscape);
            });
        }

        // View Image
        async function viewImage(imagePath) {
            const modal = document.getElementById('image-modal');
            const loading = document.getElementById('image-loading');
            const content = document.getElementById('image-content');
            const error = document.getElementById('image-error');
            const img = document.getElementById('preview-image');
            const downloadBtn = document.getElementById('download-image-btn');

            modal.classList.remove('hidden');
            loading.classList.remove('hidden');
            content.classList.add('hidden');
            error.classList.add('hidden');

            try {
                const imageUrl = `${API_BASE}/api/admin/images/${imagePath}`;
                img.src = imageUrl;

                downloadBtn.onclick = async function() {
                    try {
                        const response = await fetch(imageUrl, { credentials: 'include' });
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `donation_proof_${imagePath.split('/').pop()}`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        showToast('Screenshot downloaded', 'success');
                    } catch (err) {
                        showToast('Download failed', 'error');
                    }
                };

                img.onclick = function() {
                    window.open(imageUrl, '_blank');
                };

                await new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = reject;
                });

                loading.classList.add('hidden');
                content.classList.remove('hidden');
            } catch (err) {
                console.error('Image load error:', err);
                loading.classList.add('hidden');
                error.classList.remove('hidden');
            }
        }

        // Export Data
        async function exportData(format) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/export?format=${format}`, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `donations_${new Date().toISOString().split('T')[0]}.${format}`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showToast('Export successful', 'success');
                } else {
                    throw new Error('Export failed');
                }
            } catch (error) {
                console.error('Export error:', error);
                showToast('Failed to export data', 'error');
            }
        }

        // Change Password
        async function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/change-password`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ current_password: currentPassword, new_password: newPassword })
                });
                
                if (response.ok) {
                    showToast('Password changed successfully. Logging out...', 'success');
                    document.getElementById('change-password-form').reset();
                    
                    // Logout from session after password change for security
                    setTimeout(async () => {
                        try {
                            await fetch(`${API_BASE}/api/admin/logout`, {
                                method: 'POST',
                                credentials: 'include'
                            });
                        } catch (error) {
                            console.error('Logout error:', error);
                        }
                        // Redirect to login page
                        window.location.href = '/admin';
                    }, 1500);
                } else {
                    const data = await response.json();
                    throw new Error(data.detail || 'Failed to change password');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast(error.message, 'error');
            }
        }

        // Logout
        async function logout() {
            const confirmed = await showConfirmationModal(
                'Logout',
                'Are you sure you want to logout? You will need to login again to access the dashboard.',
                'warning'
            );
            
            if (!confirmed) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    showToast('Logging out...', 'info', 1000);
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 1000);
                } else {
                    throw new Error('Logout failed');
                }
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed', 'error');
            }
        }

        // Refresh Current Section
        async function refreshCurrentSection() {
            const icon = document.getElementById('refresh-icon-btn');
            const btn = document.getElementById('refresh-btn');
            
            // Disable button during refresh
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            
            // Add spinning animation
            icon.classList.add('rotating');
            
            try {
                await loadDashboardStats();
                await loadSubmissions();
                showToast('Data refreshed', 'success');
            } catch (error) {
                showToast('Refresh failed', 'error');
            } finally {
                // Re-enable button
                icon.classList.remove('rotating');
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // WebSocket Functions
        function setupAutoRefresh() {
            if (!WS_TOKEN) {
                console.error('No WebSocket token available');
                updateConnectionStatus('unavailable');
                return;
            }
            
            if (wsEnabled) {
                connectWebSocket();
            } else {
                updateConnectionStatus('disabled');
            }
        }

        function clearAutoRefresh() {
            wsManualDisconnect = true;
            disconnectWebSocket();
        }
        
        function connectWebSocket() {
            if (!WS_TOKEN || !wsEnabled) return;
            
            wsManualDisconnect = false;
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws/admin?token=${encodeURIComponent(WS_TOKEN)}`;
            
            console.log(' Connecting to WebSocket...');
            updateConnectionStatus('connecting');
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    console.log(' WebSocket connected!');
                    wsConnected = true;
                    wsReconnectAttempts = 0;
                    wsReconnectDelay = 3000;
                    updateConnectionStatus('connected');
                    showToast('Real-time updates connected', 'success', 2000);
                };
                
                ws.onmessage = async function(event) {
                    try {
                        const message = JSON.parse(event.data);
                        console.log(' WebSocket message:', message.type);
                        
                        switch(message.type) {
                            case 'connection_established':
                                console.log('Connection confirmed');
                                break;
                            case 'new_donation':
                                await handleNewDonation(message.data);
                                break;
                            case 'donation_verified':
                            case 'donation_unverified':
                                await handleVerificationUpdate(message.data);
                                break;
                        }
                    } catch (error) {
                        console.error('Error processing message:', error);
                    }
                };
                
                ws.onerror = function(error) {
                    console.error(' WebSocket error:', error);
                    wsConnected = false;
                    updateConnectionStatus('error');
                };
                
                ws.onclose = function(event) {
                    console.log('WebSocket closed:', event.code);
                    wsConnected = false;
                    
                    if (wsManualDisconnect || !wsEnabled) {
                        updateConnectionStatus('disabled');
                        return;
                    }
                    
                    updateConnectionStatus('disconnected');
                    
                    if (wsReconnectAttempts < wsMaxReconnectAttempts && wsEnabled) {
                        wsReconnectAttempts++;
                        console.log(`Reconnecting in ${wsReconnectDelay}ms (attempt ${wsReconnectAttempts}/${wsMaxReconnectAttempts})`);
                        setTimeout(() => {
                            if (wsEnabled && !wsManualDisconnect) {
                                connectWebSocket();
                            }
                        }, wsReconnectDelay);
                        wsReconnectDelay = Math.min(wsReconnectDelay * 1.5, 30000);
                    } else if (wsReconnectAttempts >= wsMaxReconnectAttempts) {
                        updateConnectionStatus('error');
                        showToast('Connection lost. Click to reconnect.', 'error', 5000);
                    }
                };
                
                setInterval(() => {
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({ type: 'ping' }));
                    }
                }, 30000);
                
            } catch (error) {
                console.error('Error creating WebSocket:', error);
                updateConnectionStatus('error');
            }
        }
        
        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                ws = null;
                wsConnected = false;
            }
        }
        
        function updateConnectionStatus(status) {
            // Update sidebar
            const sidebarIcon = document.getElementById('sidebar-realtime-icon');
            const sidebarStatus = document.getElementById('sidebar-realtime-status');
            
            // Update settings section
            const settingsIcon = document.getElementById('settings-realtime-icon');
            const settingsStatus = document.getElementById('settings-realtime-status');
            const settingsToggle = document.getElementById('settings-realtime-toggle');
            const settingsToggleDot = document.getElementById('settings-realtime-toggle-dot');
            
            const statusConfig = {
                'connected': {
                    icon: 'fas fa-wifi text-green-600',
                    text: 'Connected',
                    bgColor: 'bg-green-600',
                    dotTransform: 'translate-x-7'
                },
                'connecting': {
                    icon: 'fas fa-wifi text-yellow-600 animate-pulse',
                    text: 'Connecting...',
                    bgColor: 'bg-yellow-600',
                    dotTransform: 'translate-x-7'
                },
                'disconnected': {
                    icon: 'fas fa-wifi text-orange-600',
                    text: 'Disconnected',
                    bgColor: 'bg-orange-600',
                    dotTransform: 'translate-x-7'
                },
                'disabled': {
                    icon: 'fas fa-wifi-slash text-gray-400',
                    text: 'Disabled',
                    bgColor: 'bg-gray-200',
                    dotTransform: 'translate-x-1'
                },
                'error': {
                    icon: 'fas fa-wifi text-red-600',
                    text: 'Error',
                    bgColor: 'bg-red-600',
                    dotTransform: 'translate-x-7'
                },
                'unavailable': {
                    icon: 'fas fa-wifi-slash text-gray-400',
                    text: 'Unavailable',
                    bgColor: 'bg-gray-200',
                    dotTransform: 'translate-x-1'
                }
            };
            
            const config = statusConfig[status] || statusConfig['disabled'];
            
            if (sidebarIcon) sidebarIcon.className = config.icon;
            if (sidebarStatus) sidebarStatus.textContent = config.text;
            if (settingsIcon) settingsIcon.className = config.icon;
            if (settingsStatus) settingsStatus.textContent = config.text;
            if (settingsToggle) settingsToggle.className = `relative inline-flex items-center h-8 rounded-full w-14 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${config.bgColor}`;
            if (settingsToggleDot) settingsToggleDot.className = `inline-block w-6 h-6 transform bg-white rounded-full transition-transform ${config.dotTransform}`;
            
            // Show user-friendly messages for connection issues
            if (status === 'disconnected') {
                showConnectionAlert('Real-time updates temporarily disconnected. Use the Refresh button for latest data.', 'warning');
            } else if (status === 'error') {
                showConnectionAlert('Real-time connection failed. Please use the Refresh button to update data manually.', 'error');
            } else if (status === 'unavailable') {
                showConnectionAlert('Real-time updates are unavailable. Use the Refresh button to get latest updates.', 'info');
            }
        }
        
        // Show connection alert (only once per session to avoid spam)
        let connectionAlertShown = {};
        function showConnectionAlert(message, type) {
            const alertKey = `${type}_${message.substring(0, 30)}`;
            
            // Don't show the same alert multiple times in this session
            if (connectionAlertShown[alertKey]) {
                return;
            }
            
            connectionAlertShown[alertKey] = true;
            
            // Show toast notification
            showToast(message, type, 7000);
            
            // Also show a persistent banner for critical issues
            if (type === 'error' || type === 'warning') {
                showConnectionBanner(message, type);
            }
        }
        
        // Show persistent connection banner
        function showConnectionBanner(message, type) {
            // Remove existing banner if any
            const existingBanner = document.getElementById('connection-banner');
            if (existingBanner) {
                existingBanner.remove();
            }
            
            const colors = {
                'error': 'bg-red-50 border-red-200 text-red-800',
                'warning': 'bg-orange-50 border-orange-200 text-orange-800',
                'info': 'bg-blue-50 border-blue-200 text-blue-800'
            };
            
            const icons = {
                'error': 'fa-exclamation-circle text-red-600',
                'warning': 'fa-exclamation-triangle text-orange-600',
                'info': 'fa-info-circle text-blue-600'
            };
            
            const banner = document.createElement('div');
            banner.id = 'connection-banner';
            banner.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-40 max-w-2xl w-full mx-4 ${colors[type]} border rounded-lg shadow-lg p-4 fade-in`;
            banner.innerHTML = `
                <div class="flex items-start space-x-3">
                    <i class="fas ${icons[type]} text-xl mt-0.5"></i>
                    <div class="flex-1">
                        <p class="font-semibold text-sm">${message}</p>
                        <p class="text-xs mt-1 opacity-90">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Click the <strong>Refresh</strong> button in the header to manually update your data.
                        </p>
                    </div>
                    <button onclick="document.getElementById('connection-banner').remove()" 
                            class="text-gray-500 hover:text-gray-700 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            // Auto-remove after 15 seconds
            setTimeout(() => {
                if (banner && banner.parentNode) {
                    banner.style.animation = 'fadeOut 0.5s ease-out';
                    setTimeout(() => banner.remove(), 500);
                }
            }, 15000);
        }
        
        async function handleNewDonation(donationData) {
            console.log(' New donation received:', donationData.donor_name);
            
            submissionsData.unshift(donationData);
            
            await loadDashboardStats();
            applyFiltersAndSort();
            
            showToast(`New donation from ${donationData.donor_name} (${formatCurrency(donationData.amount_donated)})`, 'success', 5000);
        }
        
        async function handleVerificationUpdate(updateData) {
            console.log(' Verification update:', updateData.id);
            
            const submission = submissionsData.find(s => s.id === updateData.id);
            if (submission) {
                submission.is_verified = updateData.is_verified;
                submission.verified_by = updateData.verified_by;
                submission.verified_at = updateData.verified_at;
            }
            
            await loadDashboardStats();
            applyFiltersAndSort();
        }
        
        function toggleAutoRefresh() {
            if (!WS_TOKEN) {
                showToast('Real-time updates unavailable', 'error');
                return;
            }
            
            wsEnabled = !wsEnabled;
            
            if (wsEnabled) {
                console.log(' User enabled real-time updates');
                wsManualDisconnect = false;
                wsReconnectAttempts = 0;
                connectWebSocket();
                showToast('Enabling real-time updates...', 'info', 2000);
            } else {
                console.log(' User disabled real-time updates');
                wsManualDisconnect = true;
                disconnectWebSocket();
                updateConnectionStatus('disabled');
                showToast('Real-time updates disabled', 'info', 2000);
            }
        }

        // Utility Functions
        function formatCurrency(amount) {
            return `${parseFloat(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ETB`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatBankName(bankId) {
            const banks = {
                'commercial-bank': 'Commercial Bank',
                'abyssinia-bank': 'Abyssinia Bank',
                'awash-bank': 'Awash Bank',
                'dashen-bank': 'Dashen Bank',
                'bank-of-abyssinia': 'Bank of Abyssinia',
                'nib-bank': 'NIB Bank',
                'wegagen-bank': 'Wegagen Bank',
                'united-bank': 'United Bank',
                'oromia-bank': 'Oromia Bank',
                'cbe': 'Commercial Bank of Ethiopia'
            };
            return banks[bankId] || bankId;
        }

        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500',
                'warning': 'bg-orange-500'
            };
            
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'info': 'fa-info-circle',
                'warning': 'fa-exclamation-triangle'
            };
            
            toast.className = `toast ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3`;
            toast.innerHTML = `
                <i class="fas ${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
    </script>
</body>
</html>

